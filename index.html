<!DOCTYPE html>
<html lang="pt-BR"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MT Lex - Assistente Jur√≠dico Inteligente</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Bot√£o para abrir sidebar em mobile -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>

    <!-- Overlay para fechar sidebar em mobile -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <div class="app-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">MT Lex</h2>
                <p class="sidebar-subtitle">Menu de Funcionalidades</p>
            </div>

            <nav class="sidebar-nav">
                <!-- Se√ß√£o de Funcionalidades -->
                <div class="sidebar-section">
                    <h3 class="sidebar-section-title">üöÄ Funcionalidades</h3>
                    <div class="features-menu">
                        <button class="feature-btn mtlex-btn" onclick="openMTLexView()">
                            <span class="feature-icon">‚öñÔ∏è</span>
                            <span class="feature-name">MT Lex</span>
                        </button>
                        <button class="feature-btn social-agent-btn" onclick="openSocialAgentModal()">
                            <span class="feature-icon">ü§ñ</span>
                            <span class="feature-name">Agente Social</span>
                        </button>
                        <button class="feature-btn history-btn" onclick="openHistoryView()">
                            <span class="feature-icon">üìú</span>
                            <span class="feature-name">Hist√≥rico</span>
                        </button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Container Principal MT Lex -->
            <div class="container" id="mtLexContainer">
        <!-- Header com login/logout -->
        <div class="header">
            <div class="user-section" id="userSection">
                <div id="loginSection" class="login-section">
                    <button id="loginBtn" class="login-btn">üë§ Entrar</button>
                </div>
                <div id="userInfo" class="user-info" style="display: none;">
                    <span id="userEmail"></span>
                    <button id="logoutBtn" class="logout-btn">Sair</button>
                </div>
            </div>
            <h1>MT Lex</h1>
            <p class="instruction">
                Assistente Jur√≠dico Inteligente<br>
                Cole seu texto jur√≠dico no campo abaixo e descubra como nossa IA pode aprimorar suas teses.
            </p>
        </div>

        <div class="input-area">
            <div class="input-wrapper">
                <button id="templatesBtn" class="templates-btn" onclick="openTemplatesModal()" title="Selecionar Template">
                    üìã
                </button>
                <textarea id="inputText" placeholder="Cole aqui o texto da sua tese jur√≠dica..."></textarea>
                <div class="button-group">
                    <button id="improveBtn" onclick="improvePrompt()" title="Melhorar Prompt">
                        ‚ú®
                    </button>
                    <button class="send-button" id="generateBtn" onclick="generateThesis()">
                        ‚Üë
                    </button>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>MT Lex analisando sua tese...</p>
        </div>

        <div class="result" id="result">
            <h2>An√°lise MT Lex:</h2>
            <div id="analiseContainer" style="display: none;">
                <h3>An√°lise do Prompt</h3>
                <div>
                    <h4>Sugest√µes de Melhora</h4>
                    <p id="sugestoesMelhora"></p>
                </div>
                <div>
                    <h4>Lacunas Identificadas</h4>
                    <p id="lacunasIdentificadas"></p>
                </div>
                <div>
                    <h4>Perguntas Complementares</h4>
                    <ul id="perguntasComplementares"></ul>
                </div>
            </div>

            <!-- Nova se√ß√£o da lista edit√°vel de t√≥picos -->
            <div id="topicsSection" style="display: none;">
                <h3 style="color: #ececf1; margin-bottom: 16px; font-size: 1.2em;">T√≥picos da Tese:</h3>

                <ul id="resultado" class="editable-topics-list"></ul>
                <button id="addTopicBtn" class="add-topic-btn">+ Adicionar T√≥pico</button>
                <div class="action-buttons">
                    <button id="developSelectedBtn" class="develop-btn">Desenvolver T√≥picos Selecionados</button>
                </div>
            </div>

            <!-- Se√ß√£o para exibir os desenvolvimentos -->
            <div id="developmentsSection" style="display: none;">
                <h3 style="color: #ececf1; margin: 24px 0 16px; font-size: 1.2em;">Desenvolvimentos dos T√≥picos:</h3>
                <div id="developmentsContainer" class="developments-container"></div>
                <button id="clearDevelopmentsBtn" class="clear-developments-btn" onclick="clearDevelopments()">Limpar Desenvolvimentos</button>
            </div>

            <div class="result-content" id="resultContent"></div>
        </div>
            </div>

            <!-- Container do Agente Social -->
            <div class="container" id="socialAgentContainer" style="display: none;">
                <div class="header">
                    <h1>ü§ñ Agente Social</h1>
                    <p class="instruction">
                        Envie um documento PDF e descreva as altera√ß√µes que deseja fazer
                    </p>
                </div>

                <div class="social-agent-content">
                    <!-- √Årea de Upload -->
                    <div class="upload-section">
                        <h3 class="section-title">üìÑ Documento PDF</h3>
                        <div class="upload-area" id="uploadArea">
                            <input type="file" id="pdfUpload" class="file-input-hidden" accept=".pdf" onchange="handleFileSelect(event)">
                            <label for="pdfUpload" class="upload-label">
                                <div class="upload-icon">üìé</div>
                                <div class="upload-text">
                                    <strong>Clique para selecionar</strong> ou arraste um arquivo PDF
                                </div>
                                <div class="upload-hint">M√°ximo 10MB</div>
                            </label>
                        </div>
                        <div class="file-preview" id="filePreview" style="display: none;">
                            <div class="file-preview-content">
                                <span class="file-preview-icon">üìÑ</span>
                                <div class="file-preview-info">
                                    <div class="file-preview-name" id="fileName"></div>
                                    <div class="file-preview-size" id="fileSize"></div>
                                </div>
                                <button class="file-remove-btn" onclick="removeFile()">‚úï</button>
                            </div>
                        </div>
                    </div>

                    <!-- √Årea de Instru√ß√µes -->
                    <div class="instructions-section">
                        <h3 class="section-title">‚úçÔ∏è Instru√ß√µes de Altera√ß√£o</h3>
                        <div class="instructions-wrapper">
                            <textarea
                                id="instructionsText"
                                class="instructions-textarea"
                                placeholder="Descreva aqui as altera√ß√µes que voc√™ deseja fazer no documento...&#10;&#10;Exemplo:&#10;- Adicionar cl√°usula de confidencialidade&#10;- Alterar prazo de vig√™ncia para 24 meses&#10;- Incluir multa por rescis√£o antecipada"></textarea>
                        </div>
                    </div>

                    <!-- √Årea de Resultado -->
                    <div class="social-agent-result" id="socialAgentResult" style="display: none;">
                        <h3 class="section-title">‚úÖ Resultado</h3>
                        <div class="result-message" id="resultMessage"></div>
                    </div>

                    <!-- Bot√£o de Envio -->
                    <div class="social-agent-actions">
                        <button class="send-social-btn" id="sendSocialBtn" onclick="sendToSocialAgent()" disabled>
                            <span class="btn-icon">üöÄ</span>
                            <span class="btn-text">Enviar para An√°lise</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Container do Hist√≥rico -->
            <div class="container" id="historyContainer" style="display: none;">
                <div class="header">
                    <h1>üìú Hist√≥rico de Conversas</h1>
                    <p class="instruction">
                        Visualize todas as suas sess√µes anteriores com a MT Lex
                    </p>
                </div>

                <div class="history-content">
                    <div class="history-filters">
                        <input type="text" id="historySearch" class="history-search" placeholder="üîç Buscar por texto...">
                        <select id="historySort" class="history-sort">
                            <option value="recent">Mais recentes</option>
                            <option value="oldest">Mais antigas</option>
                        </select>
                    </div>

                    <div id="historyList" class="history-list">
                        <!-- Sess√µes ser√£o carregadas aqui via JS -->
                    </div>

                    <div id="historyLoading" class="history-loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Carregando hist√≥rico...</p>
                    </div>

                    <div id="historyEmpty" class="history-empty" style="display: none;">
                        <p>üì≠ Nenhuma conversa encontrada</p>
                        <p class="history-empty-hint">Suas conversas aparecer√£o aqui ap√≥s voc√™ usar a MT Lex</p>
                    </div>
                </div>
            </div>

        <!-- Modal de Templates -->
        <div id="templatesModal" class="templates-modal" style="display: none;">
            <div class="templates-modal-content">
                <div class="templates-modal-header">
                    <h3>üìã Selecionar Template</h3>
                    <button class="templates-close-btn" onclick="closeTemplatesModal()">‚úï</button>
                </div>
                <div class="templates-modal-body">
                    <div class="templates-list" id="templatesList">
                        <!-- Templates ser√£o inseridos aqui via JS -->
                    </div>
                    <div class="templates-actions">
                        <button class="create-template-modal-btn" onclick="closeTemplatesModal(); openCreateTemplateModal();">
                            ‚ûï Criar Novo Template
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Login -->
        <div id="loginModal" class="modal-overlay" style="display: none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h3 class="modal-title">üîê Entrar no MT Lex</h3>
                    <button class="modal-close-btn" onclick="closeLoginModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="auth-tabs">
                        <button id="loginTab" class="auth-tab active" onclick="showLoginTab()">Entrar</button>
                        <button id="signupTab" class="auth-tab" onclick="showSignupTab()">Criar Conta</button>
                    </div>

                    <!-- Formul√°rio de Login -->
                    <div id="loginForm" class="auth-form">
                        <div class="input-group">
                            <label for="loginEmail" class="input-label">E-mail:</label>
                            <input type="email" id="loginEmail" class="auth-input" placeholder="seu@email.com">
                        </div>
                        <div class="input-group">
                            <label for="loginPassword" class="input-label">Senha:</label>
                            <input type="password" id="loginPassword" class="auth-input" placeholder="Sua senha">
                        </div>
                        <div class="login-actions">
                            <button id="loginSubmitBtn" class="auth-submit-btn">üîë Entrar</button>
                            <button type="button" class="forgot-password-btn" onclick="showForgotPasswordForm()">
                                Esqueci minha senha
                            </button>
                        </div>
                    </div>

                    <!-- Formul√°rio de Recupera√ß√£o de Senha -->
                    <div id="forgotPasswordForm" class="auth-form" style="display: none;">
                        <div class="input-group">
                            <label for="forgotEmail" class="input-label">E-mail:</label>
                            <input type="email" id="forgotEmail" class="auth-input" placeholder="seu@email.com">
                            <div class="input-helper">Enviaremos um link para redefinir sua senha</div>
                        </div>
                        <button id="forgotPasswordSubmitBtn" class="auth-submit-btn">üìß Enviar Link</button>
                        <button type="button" class="back-to-login-btn" onclick="showLoginTab()">
                            ‚Üê Voltar para Login
                        </button>
                    </div>

                    <!-- Formul√°rio de Registro -->
                    <div id="signupForm" class="auth-form" style="display: none;">
                        <div class="input-group">
                            <label for="signupName" class="input-label">Nome Completo:</label>
                            <input type="text" id="signupName" class="auth-input" placeholder="Ex: Jo√£o da Silva" required>
                        </div>
                        <div class="input-group">
                            <label for="signupCargo" class="input-label">Cargo:</label>
                            <input type="text" id="signupCargo" class="auth-input" placeholder="Ex: Advogado, Estagi√°rio" required>
                        </div>
                        <div class="input-group">
                            <label for="signupTelefone" class="input-label">Telefone:</label>
                            <input type="tel" id="signupTelefone" class="auth-input" placeholder="(00) 00000-0000" required>
                        </div>
                        <div class="input-group">
                            <label for="signupEmail" class="input-label">E-mail:</label>
                            <input type="email" id="signupEmail" class="auth-input" placeholder="seu@email.com" required>
                        </div>
                        <div class="input-group">
                            <label for="signupPassword" class="input-label">Senha:</label>
                            <input type="password" id="signupPassword" class="auth-input" placeholder="M√≠nimo 6 caracteres" required>
                        </div>
                        <button id="signupSubmitBtn" class="auth-submit-btn">‚ú® Criar Conta</button>
                    </div>

                    <div id="authMessage" class="auth-message"></div>
                </div>
            </div>
        </div>

        <!-- Modal para criar template customizado -->
        <div id="createTemplateModal" class="modal-overlay" style="display: none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h3 class="modal-title">üõ†Ô∏è Criar Template Personalizado</h3>
                    <button class="modal-close-btn" onclick="closeCreateTemplateModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <p class="modal-description">
                        Criar um template com os <strong id="topicCount">0</strong> t√≥picos atuais:
                    </p>
                    <div id="topicPreview" class="topic-preview"></div>
                    <div class="input-group">
                        <label for="templateName" class="input-label">Nome do Template:</label>
                        <input type="text" id="templateName" class="template-name-input" placeholder="Ex: Meu Contrato Personalizado" maxlength="50">
                        <div class="input-helper">O template ficar√° dispon√≠vel no menu de sele√ß√£o</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-cancel-btn" onclick="closeCreateTemplateModal()">Cancelar</button>
                    <button class="modal-save-btn" onclick="saveCustomTemplate()">üíæ Salvar Template</button>
                </div>
            </div>
        </div>

        </main>
    </div>

    <script type="module">
  import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js'
  window.supabase = createClient('https://hcifazxfebcdavmzvkbr.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhjaWZhenhmZWJjZGF2bXp2a2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMDU0MzUsImV4cCI6MjA3Mzg4MTQzNX0.KE86kn-Fu3Gn_D7tYEiGB3avm37JSiPXM-pPGnWB8PI')
  </script>
  <script src="script.js"></script>
</body>
</html>
